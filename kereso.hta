<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Rendszer Mester - PROFI KERESŐ V14</title>
    <hta:application id="oHTA" border="thin" caption="yes" showintaskbar="yes" singleinstance="yes" sysmenu="yes" windowstate="normal">
    <style>
        body { background: #0a0a0a; color: #fff; font-family: 'Segoe UI', Arial; margin: 0; padding: 25px; width: 750px; }
        .window { border: 3px solid #333; border-radius: 15px; padding: 30px; box-shadow: 0 0 40px rgba(0, 246, 255, 0.5); background: #111; }
        .neon-title { color: #00f6ff; text-shadow: 0 0 15px #00f6ff; text-align: center; font-size: 36px; font-weight: normal; margin-bottom: 25px; text-transform: uppercase; letter-spacing: 3px; }
        
        .info-bar { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; padding: 12px; background: #000; border: 1px solid #222; border-radius: 8px; font-size: 14px; }
        .info-label { color: #aaa; }
        .v-good { color: #00ff00; font-weight: bold; text-shadow: 0 0 5px #00ff00; }
        .v-bad { color: #ff0000; font-weight: bold; text-shadow: 0 0 5px #ff0000; }
        .cpu-val { color: #00f6ff; font-weight: bold; font-size: 12px; }

        .input-box { margin-bottom: 20px; }
        label { display: block; color: #00f6ff; font-size: 18px; margin-bottom: 8px; font-weight: normal; text-shadow: 0 0 5px #00f6ff; }
        input, select { width: 100%; padding: 12px; background: #000; color: #fff; border: 2px solid #333; border-radius: 8px; box-sizing: border-box; font-size: 20px; font-weight: normal; }
        
        .btn-group { display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; margin-top: 15px; }
        button { padding: 15px; background: #000; font-weight: bold; cursor: pointer; text-transform: uppercase; transition: 0.4s; border-radius: 10px; border: 2px solid; }
        .btn-main { color: #00ff00; border-color: #00ff00; font-size: 22px; }
        .btn-main:hover { background: #00ff00; color: #000; box-shadow: 0 0 20px #00ff00; }
        .btn-refresh { color: #ffff00; border-color: #ffff00; font-size: 14px; }
        .btn-ps-upd { color: #ff00ff; border-color: #ff00ff; font-size: 14px; }
        
        #status { text-align: center; font-size: 18px; margin-top: 20px; color: #ffff00; font-family: 'Courier New'; }
    </style>

    <script language="javascript">
        window.resizeTo(820, 920);
        var shell = new ActiveXObject("WScript.Shell");
        var appShell = new ActiveXObject("Shell.Application");
        var detectedDrives = [];

        function initSystem() {
            getCPUInfo();
            getPSVersion();
            getDrives();
        }

        function getCPUInfo() {
            try {
                var wmi = GetObject("winmgmts:\\\\.\\root\\cimv2");
                var cpus = wmi.ExecQuery("SELECT Name FROM Win32_Processor");
                var e = new Enumerator(cpus);
                if (!e.atEnd()) {
                    var cpu = e.item();
                    document.getElementById("cpuDisplay").innerText = cpu.Name;
                }
            } catch (err) {
                document.getElementById("cpuDisplay").innerText = "Ismeretlen CPU";
            }
        }

        function getPSVersion() {
            var psElement = document.getElementById("psStatus");
            try {
                // Verzió lekérése registry-ből (gyors és nem dob hibát)
                var version = shell.RegRead("HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\PowerShell\\3\\PowerShellEngine\\PowerShellVersion");
                psElement.innerText = "v" + version;
                psElement.className = "v-good";
            } catch (e) {
                psElement.innerText = "HIBA / RÉGI";
                psElement.className = "v-bad";
            }
        }

        function updatePS() {
            var updateCmd = "powershell.exe -Command \"& { Write-Host 'Telepito inditasa...' -ForegroundColor Cyan; iex \"\"& { $(irm https://aka.ms/install-powershell.ps1) } -UseMSI\"\" }\"";
            appShell.ShellExecute("powershell.exe", updateCmd, "", "runas", 1);
        }

        function getDrives() {
            try {
                var select = document.getElementById("drive");
                select.innerHTML = ""; 
                detectedDrives = [];
                var allOpt = document.createElement("option");
                allOpt.value = "ALL";
                allOpt.text = "[!] ÖSSZES MEGHAJTÓ";
                allOpt.style.color = "#00ff00";
                select.add(allOpt);

                var fso = new ActiveXObject("Scripting.FileSystemObject");
                var e = new Enumerator(fso.Drives);
                for (; !e.atEnd(); e.moveNext()) {
                    var d = e.item();
                    if (d.IsReady) {
                        var driveLetter = d.DriveLetter + ":";
                        detectedDrives.push("'" + driveLetter + "\\'");
                        var opt = document.createElement("option");
                        opt.value = driveLetter;
                        opt.text = driveLetter + "\\ [Online]";
                        select.add(opt);
                    }
                }
                document.getElementById("status").innerHTML = "Rendszer kész.";
            } catch (err) { document.getElementById("status").innerHTML = "Hiba!"; }
        }

        function inditKereses() {
            var driveVal = document.getElementById("drive").value;
            var keyword = document.getElementById("keyword").value;
            var type = document.getElementById("stype").value;
            var mode = document.getElementById("mode").value;
            if (keyword == "") { alert("Írj be kulcsszót!"); return; }

            var driveList = (driveVal === "ALL") ? detectedDrives.join(",") : "'" + driveVal + "\\'";
            var depthPart = (mode == "2") ? "-Depth 2" : "";
            var typePart = (type == "1") ? "where {$_.PSIsContainer}" : (type == "2") ? "where {!$_.PSIsContainer}" : "where {$true}";

            var psCommand = "-NoExit -Command \"& {$found = 0; $drives = @(" + driveList + "); Write-Host '--- KERESO AKTIV ---' -ForegroundColor Cyan; foreach ($d in $drives) { Write-Host ('[SCAN] {0}' -f $d) -ForegroundColor Yellow; Get-ChildItem -Path $d -Recurse " + depthPart + " -ErrorAction SilentlyContinue | Where-Object {$_.Name -like '*" + keyword + "*'} | " + typePart + " | ForEach-Object { $found++; Write-Host ('[{0}]' -f $found) -ForegroundColor Green -NoNewline; Write-Host (' {0}' -f $_.FullName) -ForegroundColor Cyan; }; } Write-Host '--- KESZ ---' -ForegroundColor Green; }\"";
            appShell.ShellExecute("powershell.exe", psCommand, "", "runas", 1);
        }

        window.onload = initSystem;
    </script>
</head>
<body>
<div class="window">
    <div class="neon-title">Rendszer Mester</div>

    <div class="info-bar">
        <div><span class="info-label">PowerShell:</span> <span id="psStatus">Ellenőrzés...</span></div>
        <div><span class="info-label">CPU:</span> <span id="cpuDisplay" class="cpu-val">Felismerés...</span></div>
    </div>

    <div class="input-box">
        <label>KERESÉS HELYE:</label>
        <select id="drive"></select>
    </div>

    <div class="input-box">
        <label>TÍPUS:</label>
        <select id="stype">
            <option value="3">Minden (Fájl + Mappa)</option>
            <option value="2">Csak fájlok</option>
            <option value="1">Csak mappák</option>
        </select>
    </div>

    <div class="input-box">
        <label>KERESETT NÉV:</label>
        <input type="text" id="keyword" placeholder="Írd be a nevet...">
    </div>

    <div class="btn-group">
        <button class="btn-main" onclick="inditKereses()">KERESÉS</button>
        <button class="btn-refresh" onclick="initSystem()">FRISSÍT</button>
        <button class="btn-ps-upd" onclick="updatePS()">PS UPD</button>
    </div>
    <select id="mode" style="display:none;"><option value="1"></option></select>
    <div id="status">Készen áll.</div>
</div>
</body>
</html>